
<!-- <meta http-equiv="refresh" content="30"> -->
<!-- AR.js by @jerome_etienne - github: https://github.com/jeromeetienne/ar.js - info: https://medium.com/arjs/augmented-reality-in-10-lines-of-html-4e193ea9fdbf -->
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.0/aframe/examples/vendor/aframe/build/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.0/aframe/build/aframe-ar.js"></script>
<body style='margin : 0px; overflow: hidden;'>
  <a-scene embedded debugUIEnabled arjs='trackingMethod: best;'>
      <a-assets>
         <img id="bingo_card" src="./bingo.jpg">
      </a-assets>

      <a-anchor hit-testing-enabled='true'>
        <a-box id="bingoCardObject" position='0 0 0' src="#bingo_card" material='opacity: 1;' height=0.01>
          <a-box id="bingoGrid" position='0 0 0.05' material='' width=0.9 depth=0.9 height=0></a-box>
        </a-box>

      </a-anchor>
		<a-camera-static/>
	</a-scene>
</body>

<script>
// Bingo engine - RNG
var totalAmountOfBingoBalls = 10;
var numbers =  Array.apply(null, Array(totalAmountOfBingoBalls)).map((value, i) => i+1)
var els = document.querySelectorAll('.bingoMarker');

function shuffle(o) {
    for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    return o;
};
                     //  start the loop

// End Bingo Engine


// Create markers

const totalAmountOfRows = 5;
const totalAmountOfCols = 5;
const startXPosition = -0.36;
const startYPosition = -0.36;
const cellIncrement = 0.18;

const bingoCardSizeColumns = 5;
const bingoCardSizeRows = 5;

var bingoCardRows = [...Array(bingoCardSizeRows).keys()];
var cellID = 1;
var cellBingoNumber = 1;
var bingoCells = [];
var totalNumberOfCells =  Array.apply(null, Array(25)).map((value, i) => i+1);
var randomCellBingoNumbers = shuffle(totalNumberOfCells);

bingoCardRows.forEach(function (value, index){
  bingoCardRows[index] = [...Array(bingoCardSizeColumns).keys()]
  y = (startYPosition + index * cellIncrement).toFixed(2);

  bingoCardRows[index].forEach( function(value, i) {

  	x = (startXPosition + i* cellIncrement).toFixed(2);
    cellBingoNumber = randomCellBingoNumbers[cellID - 1];
    bingoCells.push({cellID, cellBingoNumber, x, y})
    cellID++;
  });
});

var bingoGrid = document.querySelector('#bingoGrid');

bingoCells.forEach(function(value, index) {
   var entityEl = document.createElement('a-box');
   var textEl = document.createElement('a-text');
   var rotationEl = document.createElement('a-entity');

   entityEl.setAttribute('id', `bingoMarker_${value.cellID}`);
   entityEl.setAttribute('class', 'bingoMarker');
   entityEl.setAttribute('position', `${value.x} 0.02 ${value.y}`);
   entityEl.setAttribute('material', 'opacity:0.1; color:black');
   entityEl.setAttribute('width', '0.125');
   entityEl.setAttribute('depth', '0.125');
   entityEl.setAttribute('height', '0.05');
   // entityEl.setAttribute('position', '0 0.05 0"');

   textEl.setAttribute('value', value.cellBingoNumber);
   textEl.setAttribute('color', 'blue');
   textEl.setAttribute('height', '1.5');
   textEl.setAttribute('width', '1.5');
   textEl.setAttribute('font', 'exo2semibold');
   textEl.setAttribute('rotation', '-90 0 0');
   textEl.setAttribute('position', '0 0.02 0');

   entityEl.appendChild(textEl);

   bingoGrid.appendChild(entityEl);
});

// End Markers


  var i = 0;                     //  set your counter to 1
  var bingoNumbers = shuffle(numbers);

function bingoEngine () {           //  create a loop function

   setTimeout(function () {    //  call a 3s setTimeout when the loop is called
     console.log(`current bingo number: ${bingoNumbers[i]}`)
      const currentCellObject = bingoCells.find(object => object.cellBingoNumber == bingoNumbers[i]);
      console.log('selected object - cell id ', currentCellObject.cellID)
      dabNumber(currentCellObject.cellID);
      i++;                     //  increment the counter
      if (i < bingoNumbers.length) {            //  if the counter < 10, call the loop function
         bingoEngine();            //  ..  again which will trigger another
      } else {
        console.log('Fin');
      }                        //  ..  setTimeout()
   }, 1000)
}

function dabNumber(cellID) {
  var selector = `#bingoMarker_${cellID}`;

 var cellToDab = document.querySelector(selector);
 cellToDab.setAttribute('color','green');
 cellToDab.setAttribute('opacity', '0.4');
 cellToDab.setAttribute('height', '0.2');
}

bingoEngine();
</script>
